<?xml version="1.0" encoding="UTF-8"?>
<!-- Reporte de Facturas por Rango de Fechas - Basado en Cashier-Report -->
<jasperReport name="InvoicesByDate" language="java" columnCount="1" pageWidth="595" pageHeight="842" columnWidth="515" leftMargin="40" rightMargin="40" topMargin="50" bottomMargin="50" uuid="a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="One Empty Record"/>
	
	<!-- PARÁMETROS DEL REPORTE -->
	<parameter name="dateFrom" class="java.time.LocalDate"/>
	<parameter name="dateTo" class="java.time.LocalDate"/>
	<parameter name="companyName" class="java.lang.String"/>
	<parameter name="restaurantAddress" class="java.lang.String"/>
	<parameter name="restaurantPhone" class="java.lang.String"/>
	<parameter name="currency" class="java.lang.String">
		<defaultValueExpression><![CDATA["₡"]]></defaultValueExpression>
	</parameter>
	<parameter name="totalRecords" class="java.lang.Integer"/>
	<parameter name="totalAmount" class="java.lang.Double"/>
	<parameter name="totalSubtotal" class="java.lang.Double"/>
	<parameter name="totalTaxAmount" class="java.lang.Double"/>
	<parameter name="totalServiceAmount" class="java.lang.Double"/>
	<parameter name="totalDiscountAmount" class="java.lang.Double"/>
	<parameter name="averageTicket" class="java.lang.Double"/>
	<parameter name="reportGeneratedAt" class="java.time.LocalDate"/>
	<parameter name="generatedByUser" class="java.lang.String"/>
	
	<query language="sql"><![CDATA[]]></query>
	
	<!-- FIELDS DEL DATASOURCE (InvoiceDTO) -->
	<field name="invoiceNumber" class="java.lang.String"/>
	<field name="createdAt" class="java.time.LocalDate"/>
	<field name="customerName" class="java.lang.String"/>
	<field name="createdByName" class="java.lang.String"/>
	<field name="paymentMethod" class="java.lang.String"/>
	<field name="subtotal" class="java.lang.Double"/>
	<field name="taxRate" class="java.lang.Double"/>
	<field name="serviceRate" class="java.lang.Double"/>
	<field name="discountRate" class="java.lang.Double"/>
	<field name="total" class="java.lang.Double"/>
	<field name="amountReceived" class="java.lang.Double"/>
	<field name="changeAmount" class="java.lang.Double"/>
	
	<background/>
	
	<!-- ENCABEZADO PRINCIPAL - TITLE BAND -->
	<title height="100">
		<!-- Fondo gris del encabezado -->
		<element kind="frame" uuid="a7255fe5-a5e7-4933-8c32-69fdc6fd2c51" mode="Opaque" x="-20" y="-20" width="560" height="120" backcolor="#1F4E78">
			<!-- Logo / Nombre del Restaurante -->
			<element kind="staticText" uuid="710078e1-fc28-4c8c-b641-09642f4e845c" x="20" y="15" width="350" height="30" forecolor="#FFFFFF" fontSize="22.0" bold="true">
				<text><![CDATA[REPORTE DE FACTURAS]]></text>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
				<property name="com.jaspersoft.studio.unit.width" value="px"/>
			</element>
			
			<!-- Nombre Empresa -->
			<element kind="textField" uuid="dd05e9e2-6cc8-4eb8-8670-b4b93b6e3101" x="20" y="45" width="350" height="18" forecolor="#FFFFFF" markup="none" fontSize="13.0" bold="true">
				<expression><![CDATA[$P{companyName}]]></expression>
				<property name="com.jaspersoft.studio.unit.y" value="px"/>
				<property name="com.jaspersoft.studio.unit.width" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Dirección -->
			<element kind="textField" uuid="bfcbc737-7eab-4fde-9c3a-fc912688da46" x="20" y="63" width="350" height="15" forecolor="#E0E0E0" fontSize="11.0">
				<expression><![CDATA[$P{restaurantAddress} != null ? $P{restaurantAddress} : "Dirección no disponible"]]></expression>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
				<property name="com.jaspersoft.studio.unit.width" value="px"/>
				<property name="com.jaspersoft.studio.unit.y" value="px"/>
			</element>
			
			<!-- Teléfono -->
			<element kind="textField" uuid="08f618a8-a8f1-45c2-bfe2-63ddda56916a" x="20" y="78" width="350" height="15" forecolor="#E0E0E0" fontSize="11.0">
				<expression><![CDATA[$P{restaurantPhone} != null ? "Tel: " + $P{restaurantPhone} : ""]]></expression>
				<property name="com.jaspersoft.studio.unit.width" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Período del reporte (derecha arriba) -->
			<element kind="staticText" uuid="período-label" x="370" y="15" width="60" height="15" forecolor="#FFFFFF" fontSize="11.0" bold="true">
				<text><![CDATA[Período:]]></text>
			</element>
			<element kind="textField" uuid="período-values" x="370" y="30" width="150" height="18" forecolor="#FFFF99" fontSize="11.0">
				<expression><![CDATA[$P{dateFrom} + " a " + $P{dateTo}]]></expression>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Fecha de generación -->
			<element kind="staticText" uuid="generated-label" x="370" y="52" width="60" height="13" forecolor="#FFFFFF" fontSize="10.0">
				<text><![CDATA[Generado:]]></text>
			</element>
			<element kind="textField" uuid="generated-date" x="370" y="65" width="150" height="13" forecolor="#E0E0E0" fontSize="10.0">
				<expression><![CDATA[$P{reportGeneratedAt}]]></expression>
			</element>
		</element>
	</title>
	
	<!-- ENCABEZADO DE COLUMNAS -->
	<pageHeader height="15"/>
	
	<columnHeader height="40">
		<!-- Línea separadora -->
		<element kind="line" uuid="line-top" x="-20" y="0" width="560" height="1" forecolor="#1F4E78"/>
		
		<!-- Encabezados de columnas -->
		<element kind="staticText" uuid="col-header-invoice" x="40" y="8" width="65" height="18" forecolor="#FFFFFF" backcolor="#1F4E78" fontSize="11.0" bold="true" mode="Opaque">
			<text><![CDATA[Factura]]></text>
		</element>
		<element kind="staticText" uuid="col-header-date" x="110" y="8" width="60" height="18" forecolor="#FFFFFF" backcolor="#1F4E78" fontSize="11.0" bold="true" mode="Opaque">
			<text><![CDATA[Fecha]]></text>
		</element>
		<element kind="staticText" uuid="col-header-client" x="175" y="8" width="85" height="18" forecolor="#FFFFFF" backcolor="#1F4E78" fontSize="11.0" bold="true" mode="Opaque">
			<text><![CDATA[Cliente]]></text>
		</element>
		<element kind="staticText" uuid="col-header-cashier" x="265" y="8" width="70" height="18" forecolor="#FFFFFF" backcolor="#1F4E78" fontSize="11.0" bold="true" mode="Opaque">
			<text><![CDATA[Cajero]]></text>
		</element>
		<element kind="staticText" uuid="col-header-payment" x="338" y="8" width="50" height="18" forecolor="#FFFFFF" backcolor="#1F4E78" fontSize="10.0" bold="true" mode="Opaque" hTextAlign="Center">
			<text><![CDATA[Pago]]></text>
		</element>
		<element kind="staticText" uuid="col-header-subtotal" x="391" y="8" width="50" height="18" forecolor="#FFFFFF" backcolor="#1F4E78" fontSize="10.0" bold="true" mode="Opaque" hTextAlign="Right">
			<text><![CDATA[Subtotal]]></text>
		</element>
		<element kind="staticText" uuid="col-header-total" x="444" y="8" width="50" height="18" forecolor="#FFFFFF" backcolor="#1F4E78" fontSize="10.0" bold="true" mode="Opaque" hTextAlign="Right">
			<text><![CDATA[Total]]></text>
		</element>
		
		<!-- Línea separadora -->
		<element kind="line" uuid="line-header-bottom" x="-20" y="38" width="560" height="1" forecolor="#1F4E78"/>
	</columnHeader>
	
	<!-- DETALLE - UNA FILA POR FACTURA -->
	<detail>
		<band height="32">
			<!-- Fondo alterno para mejor legibilidad -->
			<element kind="frame" uuid="row-background" mode="Opaque" x="-20" y="0" width="560" height="32" backcolor="#F5F5F5" printWhenExpression="$V{REPORT_COUNT} % 2 == 0"/>
			
			<!-- Número de factura -->
			<element kind="textField" uuid="detail-invoice" x="40" y="7" width="65" height="18" fontSize="10.0">
				<expression><![CDATA[$F{invoiceNumber}]]></expression>
				<property name="com.jaspersoft.studio.unit.x" value="px"/>
				<property name="com.jaspersoft.studio.unit.y" value="px"/>
				<property name="com.jaspersoft.studio.unit.width" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Fecha -->
			<element kind="textField" uuid="detail-date" x="110" y="7" width="60" height="18" fontSize="10.0">
				<expression><![CDATA[$F{createdAt}]]></expression>
				<property name="com.jaspersoft.studio.unit.x" value="px"/>
				<property name="com.jaspersoft.studio.unit.y" value="px"/>
				<property name="com.jaspersoft.studio.unit.width" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Cliente -->
			<element kind="textField" uuid="detail-client" x="175" y="7" width="85" height="18" fontSize="10.0">
				<expression><![CDATA[$F{customerName} != null && !$F{customerName}.isEmpty() ? $F{customerName} : "General"]]></expression>
				<property name="com.jaspersoft.studio.unit.x" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Cajero -->
			<element kind="textField" uuid="detail-cashier" x="265" y="7" width="70" height="18" fontSize="10.0">
				<expression><![CDATA[$F{createdByName}]]></expression>
				<property name="com.jaspersoft.studio.unit.x" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Método de pago -->
			<element kind="textField" uuid="detail-payment" x="338" y="7" width="50" height="18" fontSize="10.0" hTextAlign="Center">
				<expression><![CDATA[$F{paymentMethod} != null ? ($F{paymentMethod}.equals("CASH") ? "Efectivo" : $F{paymentMethod}.equals("CARD") ? "Tarjeta" : $F{paymentMethod}) : "-"]]></expression>
				<property name="com.jaspersoft.studio.unit.x" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Subtotal -->
			<element kind="textField" uuid="detail-subtotal" x="391" y="7" width="50" height="18" fontSize="10.0" hTextAlign="Right">
				<expression><![CDATA[$F{subtotal} != null ? new java.text.DecimalFormat("#,##0.00").format($F{subtotal}) : "0.00"]]></expression>
				<property name="com.jaspersoft.studio.unit.x" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Total -->
			<element kind="textField" uuid="detail-total" x="444" y="7" width="50" height="18" fontSize="10.0" bold="true" hTextAlign="Right">
				<expression><![CDATA[$F{total} != null ? new java.text.DecimalFormat("#,##0.00").format($F{total}) : "0.00"]]></expression>
				<property name="com.jaspersoft.studio.unit.x" value="px"/>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</element>
			
			<!-- Línea separadora entre filas -->
			<element kind="line" uuid="row-separator" positionType="FixRelativeToBottom" x="-20" y="30" width="560" height="1" forecolor="#CCCCCC"/>
		</band>
	</detail>
	
	<!-- PÁGINA FOOTER -->
	<pageFooter height="25">
		<element kind="textField" uuid="page-number-left" x="-20" y="5" width="100" height="12" fontSize="9.0" forecolor="#666666">
			<expression><![CDATA["Página " + $V{PAGE_NUMBER}]]></expression>
		</element>
		<element kind="textField" uuid="page-number-right" mode="Opaque" x="440" y="5" width="80" height="12" fontSize="9.0" forecolor="#666666" hTextAlign="Right">
			<expression><![CDATA["de " + $V{PAGE_COUNT}]]></expression>
		</element>
	</pageFooter>
	
	<!-- ÚLTIMA PÁGINA FOOTER -->
	<lastPageFooter height="15">
		<element kind="line" uuid="line-footer-top" x="-20" y="0" width="560" height="1" forecolor="#1F4E78"/>
	</lastPageFooter>
	
	<!-- RESUMEN - TOTALES -->
	<summary height="180">
		<!-- Fondo del resumen -->
		<element kind="frame" uuid="summary-frame" mode="Opaque" x="-20" y="0" width="560" height="180" backcolor="#E8EFF7"/>
		
		<!-- Título del resumen -->
		<element kind="staticText" uuid="summary-title" x="40" y="10" width="200" height="22" forecolor="#1F4E78" fontSize="14.0" bold="true">
			<text><![CDATA[RESUMEN DEL PERÍODO]]></text>
		</element>
		
		<!-- Línea decorativa -->
		<element kind="line" uuid="line-summary-title" x="40" y="32" width="435" height="2" forecolor="#1F4E78"/>
		
		<!-- FILA 1: Total de Registros -->
		<element kind="staticText" uuid="label-records" x="50" y="40" width="150" height="18" forecolor="#1F4E78" fontSize="11.0">
			<text><![CDATA[Total de Facturas:]]></text>
		</element>
		<element kind="textField" uuid="value-records" x="200" y="40" width="80" height="18" forecolor="#1F4E78" fontSize="11.0" bold="true">
			<expression><![CDATA[$P{totalRecords}]]></expression>
		</element>
		
		<!-- FILA 2: Subtotal Global -->
		<element kind="staticText" uuid="label-subtotal" x="50" y="60" width="150" height="18" forecolor="#1F4E78" fontSize="11.0">
			<text><![CDATA[Subtotal Global:]]></text>
		</element>
		<element kind="textField" uuid="value-subtotal" x="200" y="60" width="80" height="18" forecolor="#1F4E78" fontSize="11.0" bold="true">
			<expression><![CDATA[($P{totalSubtotal} != null ? new java.text.DecimalFormat("#,##0.00").format($P{totalSubtotal}) : "0.00")]]></expression>
		</element>
		
		<!-- FILA 3: IVA Total -->
		<element kind="staticText" uuid="label-tax" x="50" y="80" width="150" height="18" forecolor="#1F4E78" fontSize="11.0">
			<text><![CDATA[Total IVA:]]></text>
		</element>
		<element kind="textField" uuid="value-tax" x="200" y="80" width="80" height="18" forecolor="#1F4E78" fontSize="11.0" bold="true">
			<expression><![CDATA[($P{totalTaxAmount} != null ? new java.text.DecimalFormat("#,##0.00").format($P{totalTaxAmount}) : "0.00")]]></expression>
		</element>
		
		<!-- FILA 4: Servicio Total -->
		<element kind="staticText" uuid="label-service" x="50" y="100" width="150" height="18" forecolor="#1F4E78" fontSize="11.0">
			<text><![CDATA[Total Servicio:]]></text>
		</element>
		<element kind="textField" uuid="value-service" x="200" y="100" width="80" height="18" forecolor="#1F4E78" fontSize="11.0" bold="true">
			<expression><![CDATA[($P{totalServiceAmount} != null ? new java.text.DecimalFormat("#,##0.00").format($P{totalServiceAmount}) : "0.00")]]></expression>
		</element>
		
		<!-- FILA 5: Descuento Total -->
		<element kind="staticText" uuid="label-discount" x="50" y="120" width="150" height="18" forecolor="#1F4E78" fontSize="11.0">
			<text><![CDATA[Total Descuentos:]]></text>
		</element>
		<element kind="textField" uuid="value-discount" x="200" y="120" width="80" height="18" forecolor="#1F4E78" fontSize="11.0" bold="true">
			<expression><![CDATA[($P{totalDiscountAmount} != null ? new java.text.DecimalFormat("#,##0.00").format($P{totalDiscountAmount}) : "0.00")]]></expression>
		</element>
		
		<!-- Línea decorativa antes del total -->
		<element kind="line" uuid="line-summary-total" x="40" y="142" width="435" height="2" forecolor="#1F4E78"/>
		
		<!-- FILA 6: TOTAL GENERAL (DESTACADO) -->
		<element kind="staticText" uuid="label-total-final" x="50" y="148" width="150" height="22" forecolor="#FFFFFF" fontSize="13.0" bold="true" backcolor="#1F4E78" mode="Opaque">
			<text><![CDATA[MONTO TOTAL:]]></text>
		</element>
		<element kind="textField" uuid="value-total-final" x="200" y="148" width="100" height="22" forecolor="#FFFFFF" fontSize="13.0" bold="true" backcolor="#1F4E78" mode="Opaque" hTextAlign="Right">
			<expression><![CDATA[($P{totalAmount} != null ? new java.text.DecimalFormat("#,##0.00").format($P{totalAmount}) : "0.00")]]></expression>
		</element>
		
		<!-- FILA 7: Ticket Promedio -->
		<element kind="staticText" uuid="label-average" x="315" y="148" width="100" height="22" forecolor="#1F4E78" fontSize="11.0">
			<text><![CDATA[Ticket Promedio:]]></text>
		</element>
		<element kind="textField" uuid="value-average" x="415" y="148" width="80" height="22" forecolor="#1F4E78" fontSize="11.0" bold="true" hTextAlign="Right">
			<expression><![CDATA[($P{averageTicket} != null ? new java.text.DecimalFormat("#,##0.00").format($P{averageTicket}) : "0.00")]]></expression>
		</element>
	</summary>
</jasperReport>
